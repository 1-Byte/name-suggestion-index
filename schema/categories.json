{
  "title": "categories.json",
  "description": "JSON Schema for name-suggestion-index category files",
  "type": "object",
  "required": ["properties", "items"],
  "additionalProperties": false,
  "properties": {

    "properties": {
      "description": "(required) An Object containing properties for this category",
      "type": "object",
      "required": ["path"],
      "additionalProperties": false,
      "properties": {

        "path": {
          "description": "(required) The path for this category in the form tree/key/value",
          "type": "string",
          "pattern": "^\\S+/\\S+/\\S+$"
        },

        "mergeStrategy": {
          "$comment": "Values here should be patterns that match OSM tag keys",
          "description": "(optional) Strategy to take when merging tag values from name-suggestion-index into OpenStreetMap",
          "type": "object",
          "required": [],
          "additionalProperties": false,

          "properties": {
            "add": {
              "description": "(optional) Values in OSM can be added, but existing values should not be modified",
              "examples": ["^building$", "^flag:name$", "^takeaway$"],
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string",
                "format": "regex"
              }
            },
            "replace": {
              "description": "(optional) Values in OSM are always replaced with values in NSI",
              "default": [".*"],
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string",
                "format": "regex"
              }
            },
            "ignore": {
              "description": "(optional) Values in NSI are never used to update OSM",
              "examples": ["^payment:"],
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string",
                "format": "regex"
              }
            }
          }
        },

        "skipCollection": {
          "description": "(optional) If 'true', skip the step to collect new items from the OSM planet",
          "type": "boolean",
          "default": false
        },

        "exclude": {
          "description": "(optional) Patterns to match names that should be excluded from this category",
          "type": "object",
          "required": [],
          "additionalProperties": false,

          "properties": {
            "generic": {
              "description": "(optional) Patterns to match generic names that should be excluded (e.g. 'restaurant', 'burger') ",
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string",
                "format": "regex"
              }
            },
            "named": {
              "description": "(optional) Patterns to match proper names to exclude from this category (e.g. 'china wok', 'pizza king')",
              "type": "array",
              "uniqueItems": true,
              "items": {
                "type": "string",
                "format": "regex"
              }
            }
          }
        }

      }
    },

    "items": {
      "description": "(required) The items in this category",
      "type": "array",
      "uniqueItems": true,
      "items": {
        "anyOf": [
          { "$ref": "#/definitions/normalItem" },
          { "$ref": "#/definitions/templateItem" }
        ]
      }
    }

  },

  "definitions": {
    "locationSet": {
      "$comment": "See location-conflation documentation for compatible values: https://github.com/ideditor/location-conflation#readme",
      "type": "object",
      "additionalProperties": false,
      "required": ["include"],
      "properties": {

        "include": {
          "description": "(required) locations included",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "anyOf": [
              { "$ref": "#/definitions/countryCoder" },
              { "$ref": "#/definitions/coordinatePair" },
              { "$ref": "#/definitions/geojsonFilename" }
            ]
          }
        },

        "exclude": {
          "description": "(optional) locations excluded",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "anyOf": [
              { "$ref": "#/definitions/countryCoder" },
              { "$ref": "#/definitions/coordinatePair" },
              { "$ref": "#/definitions/geojsonFilename" }
            ]
          }
        }
      }
    },

    "countryCoder": {
      "$comment": "See country-coder documentation for compatible values: https://github.com/ideditor/country-coder#readme",
      "description": "A country code (ISO 3166-1, United Nations M49, or anything recognized by country-coder)",
      "type": "string"
    },

    "coordinatePair": {
      "description": "A coordinate pair formatted as [longitude, latitude]",
      "type": "array",
      "items": {
        "type": "number",
        "minItems": 2,
        "maxItems": 2
      }
    },

    "geojsonFilename": {
      "description": "A filename for one of the geojson features in this project",
      "type": "string",
      "pattern": "^.*\\.geojson$"
    },

    "notTags": {
      "description": "A list of properties that we never want as tags, this is to prevent common mistakes",
      "type": "object",
      "properties": {
        "displayName":     { "not" : {} },
        "exclude":         { "not" : {} },
        "id":              { "not" : {} },
        "include":         { "not" : {} },
        "locationSet":     { "not" : {} },
        "mergeStrategy":   { "not" : {} },
        "matchNames":      { "not" : {} },
        "matchTags":       { "not" : {} },
        "path":            { "not" : {} },
        "note":            { "not" : {} },
        "skipCollection":  { "not" : {} },
        "tags":            { "not" : {} },
        "templateSource":  { "not" : {} },
        "templateTags":    { "not" : {} }
      }
    },

    "normalItem": {
      "description": "A normal item (not a template item)",
      "type": "object",
      "additionalProperties": false,
      "required": ["displayName", "locationSet", "tags"],
      "properties": {

        "displayName": {
          "description": "(required) A display name for this entry.",
          "type": "string"
        },

        "id": {
          "description": "(generated) A unique identifier generated automatically.",
          "type": "string"
        },

        "locationSet": {
          "$comment": "See location-conflation documentation for compatible values: https://github.com/ideditor/location-conflation#readme",
          "description": "(required) included and excluded locations for this item",
          "$ref": "#/definitions/locationSet"
        },

        "matchNames": {
          "description": "(optional) An array of alternate but less-desired names.",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string"
          }
        },

        "matchTags": {
          "description": "(optional) An array of alternate but less-desired tag-pairs.",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "pattern": "^\\S+/\\S+$"
          }
        },

        "note": {
          "description": "(optional) An optional note - can contain anything about the item.",
          "type": "string"
        },

        "tags": {
          "$comment": "Exclude properties that should appear elsewhere to avoid common mistakes",
          "description": "(required) OpenStreetMap tags to associate with this item",
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/notTags" }
          ],
          "anyOf": [
            { "required": ["brand"] },
            { "required": ["flag:name", "flag:type"] },
            { "required": ["operator"] },
            { "required": ["network"] }
          ]
        }

      }
    },

    "templateItem": {
      "description": "Template items get expanded into normal items when the index is built",
      "type": "object",
      "additionalProperties": false,
      "required": ["templateSource", "templateTags"],
      "properties": {

        "note": {
          "description": "(optional) An optional note - can contain anything about the item.",
          "type": "string"
        },

        "templateInclude": {
          "description": "(optional) Patterns to match source item IDs to be included (if not specified, all source items are included)",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "format": "regex"
          }
        },

        "templateExclude": {
          "description": "(optional) Patterns to match source item IDs to be excluded (if not specified, all source items are included)",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "format": "regex"
          }
        },

        "templateSource": {
          "description": "(required) A tree/key/value path to use as the source of the expanded items",
          "examples": ["operators/amenity/post_office"],
          "type": "string",
          "pattern": "^\\S+/\\S+/\\S+$"
        },

        "templateTags": {
          "$comment": "Exclude properties that should appear elsewhere to avoid common mistakes",
          "description": "(required) OpenStreetMap tags to change from the source tags",
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/notTags" }
          ]
        }

      }
    }
  }

}
